define(["jquery","underscore","backbone","scripts/collections/movies","scripts/collections/suggestedmovies","scripts/collections/actors","scripts/models/movie","scripts/models/actor","scripts/views/search","scripts/views/list","scripts/views/options","scripts/views/actordetail","scripts/views/moviedetail","scripts/views/error"],function(a,b,g,l,o,e,j,c,n,i,m,d,k,h){var f=g.Router.extend({apiKey:"7d1782adfaae73da606b85799a92dbd3",movieDbApiUrl:"http://api.themoviedb.org/",movieDbImagesUrl:null,autoCompleteResponseObj:null,movieListArray:[],routes:{"":"showGeneralSearch",detailedSearch:"showDetailedSearch"},initialize:function(){b.bindAll(this,"searchRequestSelectAutoComplete","showAutoCompleteActorsInfo","showMovieListInfo","getMovies","getMovieDBConfiguration","onSelectedItem","onClickSortButton","showDetailedSearch","getMovieDBConfigurationSuccess","getMovieDBConfigurationError","searchRequestAutoCompleteError","getActorError");this.currentActorId=null;this.selectedActorModel=new c();this.selectedActorModel.on("change",this.updateActorDetailView,this);this.selectedMovieModel=new j();this.selectedMovieModel.on("change",this.updateMovieDetailView,this);this.moviesCollection=new l();this.moviesCollection.on("reset",this.showMovieListInfo,this);this.moviesAutocompleteCollection=new o();this.moviesAutocompleteCollection.on("reset",this.showAutoCompleteMovieInfo,this);this.actorsCollection=new e();this.actorsCollection.on("reset",this.showAutoCompleteActorsInfo,this);this.bigSearchView=new n({searchInputId:"queryinput",searchRadioButtonName:"queryelement",searchButtonName:"searchButton"});this.bigSearchView.searchRequest=this.searchRequestSelectAutoComplete;this.bigSearchView.selectedItem=this.onSelectedItem;this.bigSearchView.setElement(a("#bigsearch"));this.bigSearchView.render();this.smallSearchView=new n({searchInputId:"smallsearchqueryinput",searchRadioButtonName:"smallsearchqueryelement",searchButtonName:"smallsearchbutton"});this.smallSearchView.searchRequest=this.searchRequestSelectAutoComplete;this.smallSearchView.selectedItem=this.onSelectedItem;this.smallSearchView.setElement(a("#smallsearch"));this.smallSearchView.render();this.listView=new i();this.listView.setElement(a("#smallsearchlist"));this.listView.render();this.optionsView=new m();this.optionsView.onClickSortButton=this.onClickSortButton;this.optionsView.setElement(a("#smallsearchoptionsheader"));this.optionsView.render();this.actorDetailView=new d();this.actorDetailView.setElement(a("#smallsearchactordetail"));this.actorDetailView.render();this.movieDetailView=new k();this.movieDetailView.setElement(a("#smallsearchmoviedetail"));this.movieDetailView.render();this.errorBigSearchView=new h({errorMessageElementId:"bigsearcherrormessage"});this.errorBigSearchView.setElement(a("#bigsearcherrorheader"));this.errorBigSearchView.render();this.errorSmallSearchView=new h({errorMessageElementId:"smallsearcherrormessage"});this.errorSmallSearchView.setElement(a("#smallsearcherrorheader"));this.errorSmallSearchView.render();this.getMovieDBConfiguration()},onClickSortButton:function(){this.moviesCollection.is_asc=!this.moviesCollection.is_asc;var p=this.getMovieURL(this.currentItemId,this.currentItemType);this.getMovies(this.currentItemType,p);this.optionsView.changeButtonLabel(this.moviesCollection.is_asc)},getMovieDBConfiguration:function(){a.ajax({type:"GET",url:this.movieDbApiUrl+"3/configuration?api_key="+this.apiKey,contentType:"application/json",dataType:"jsonp",success:this.getMovieDBConfigurationSuccess,error:this.getMovieDBConfigurationError})},getMovieDBConfigurationSuccess:function(p,r,q){this.setMovieDBConfiguration(p)},getMovieDBConfigurationError:function(q,r,p){this.generalError()},setMovieDBConfiguration:function(p){this.movieDbImagesUrl=p.images.base_url;this.listView.setImageURLRoot(this.movieDbImagesUrl);this.actorDetailView.setImageURLRoot(this.movieDbImagesUrl);this.movieDetailView.setImageURLRoot(this.movieDbImagesUrl)},searchRequestSelectAutoComplete:function(q,s,r){this.autoCompleteResponseObj=r;var u=encodeURIComponent(q);var t="";var p=null;if(s=="actor"){t=this.movieDbApiUrl+"3/search/person?api_key="+this.apiKey+"&query="+u+"&page=1";p=this.actorsCollection}else{t=this.movieDbApiUrl+"3/search/movie?api_key="+this.apiKey+"&query="+u+"&page=1";p=this.moviesAutocompleteCollection}this.searchRequestAutoComplete(u,t,p)},searchRequestAutoComplete:function(r,s,p){p.url=s;var q={type:"GET",contentType:"application/json",cache:false,dataType:"jsonp",error:this.searchRequestAutoCompleteError};p.fetch(q)},searchRequestAutoCompleteError:function(q,r,p){this.generalError()},generalError:function(){this.errorBigSearchView.showMessage("there was an error, please try reloading the page in a few minutes")},onSelectedItem:function(p,r){if(p!=null){this.currentItemId=p;this.currentItemType=r;this.currentSearchText=this.bigSearchView.getInputText();this.clearCurrentSelectedModels();var s=this.getMovieURL(p,r);this.getMovies(r,s);var q=this.getItemDetailURL(p,r);this.getItemInfo(r,q);location.hash="#detailedSearch"}},clearCurrentSelectedModels:function(){this.selectedMovieModel.clear({silent:true});this.selectedActorModel.clear({silent:true})},showGeneralSearch:function(){this.smallSearchView.hide();this.bigSearchView.updateViewData(this.currentSearchText,this.currentItemType);this.bigSearchView.show()},showDetailedSearch:function(){this.bigSearchView.hide();this.smallSearchView.updateViewData(this.currentSearchText,this.currentItemType);this.smallSearchView.show()},getItemInfo:function(p,q){if(p=="actor"){this.getActor(q)}else{this.getMovie(q)}},getActor:function(q){this.selectedActorModel.url=q;var p={type:"GET",contentType:"application/json",cache:false,dataType:"jsonp",error:this.getActorError};this.selectedActorModel.fetch(p)},getActorError:function(q,r,p){this.generalError()},getMovie:function(q){this.selectedMovieModel.url=q;var p={type:"GET",contentType:"application/json",cache:false,dataType:"jsonp",success:this.getMovieCreditsByPersonIdSuccess,error:this.getMovieCreditsByPersonIdError};this.selectedMovieModel.fetch(p)},getItemDetailURL:function(p,r){var q="";if(r=="actor"){q=this.movieDbApiUrl+"3/person/"+p+"?api_key="+this.apiKey}else{q=this.movieDbApiUrl+"3/movie/"+p+"?api_key="+this.apiKey}return q},getMovieURL:function(p,r){var q="";if(r=="actor"){q=this.movieDbApiUrl+"3/person/"+p+"/movie_credits?api_key="+this.apiKey}else{q=this.movieDbApiUrl+"3/movie/"+p+"/similar?api_key="+this.apiKey}return q},getMovies:function(q,r){this.moviesCollection.url=r;this.moviesCollection.type=q;var p={type:"GET",contentType:"application/json",cache:false,dataType:"jsonp"};this.moviesCollection.fetch(p)},updateActorDetailView:function(){this.hideDetailViews();this.actorDetailView.show();this.actorDetailView.updateViewData(this.selectedActorModel)},updateMovieDetailView:function(){this.hideDetailViews();this.movieDetailView.show();this.movieDetailView.updateViewData(this.selectedMovieModel)},hideDetailViews:function(){this.actorDetailView.hide();this.movieDetailView.hide()},showAutoCompleteActorsInfo:function(){var p=[];var r=0;if(this.actorsCollection.length>0){this.actorsCollection.each(function(u,t){if(r<5){r++;var v=u.attributes.id;var w=u.attributes.name;var s={};s.label=w;s.value=w;s.id=v;p.push(s)}})}else{var q={};q.label="No actor was found";q.value="No actor was found";q.id=null;p.push(q)}this.autoCompleteResponseObj(p)},showAutoCompleteMovieInfo:function(){var p=[];var r=0;if(this.moviesAutocompleteCollection.length>0){this.moviesAutocompleteCollection.each(function(u,t){if(r<5){r++;var v=u.attributes.id;var w=u.attributes.original_title;var s={};s.label=w;s.value=w;s.id=v;p.push(s)}})}else{var q={};q.label="No movie was found";q.value="No movie was found";q.id=null;p.push(q)}this.autoCompleteResponseObj(p)},showMovieListInfo:function(){this.listView.refreshMovieList(this.moviesCollection)}});g.history.start();return f});